### **TASK: AL-01 (Revised)**

#### **Title:**
Architectural Foundation: Define Core Pydantic Data Models

#### **Context:**
To build a robust and maintainable system, we must operate on strongly-typed, validated data structures. We are establishing the core data models for our entire workflow using Pydantic. This ensures that all data moving through Alfred is predictable, explicit, and free of "magic strings." This task defines the three fundamental objects: `Task` (the unit of business value), `SLOT` (the unit of technical execution), and `Taskflow` (the detailed procedure within a SLOT). This is the schema foundation for all subsequent development.

#### **Implementation Details:**
1.  **Create a new `schemas.py` file.** This file will be the single source of truth for our core workflow data models.
2.  **Define a `TaskStatus` Enum.** We will eliminate magic strings for task statuses by defining a strict `Enum`.
3.  **Define the `Task` Pydantic model.** This will be the comprehensive, structured object representing a work item, as we designed previously. It will use the `TaskStatus` enum.
4.  **Define the `Taskflow` and `SLOT` Pydantic models.** This formalizes the structure of our `ExecutionPlan`, ensuring every SLOT is a validated object. It will use an `OperationType` enum.

**Dev Notes:**
*   This is a foundational task. The models defined here will be imported and used by every other component in the system. Precision is critical.
*   The use of `Enum` for `TaskStatus` and `OperationType` is a non-negotiable requirement to enforce type safety and eliminate errors from typos or incorrect string values.

**Files to Modify:**

1.  **`src/alfred_new/models/schemas.py` (NEW FILE):**
    ```python
    # src/alfred_new/models/schemas.py
    from pydantic import BaseModel, Field
    from typing import List, Optional
    from enum import Enum

    class TaskStatus(str, Enum):
        """Enumeration for the high-level status of a Task."""
        NEW = "new"
        PLANNING = "planning"
        READY_FOR_DEVELOPMENT = "ready_for_development"
        IN_DEVELOPMENT = "in_development"
        READY_FOR_REVIEW = "ready_for_review"
        IN_REVIEW = "in_review"
        REVISIONS_REQUESTED = "revisions_requested"
        READY_FOR_TESTING = "ready_for_testing"
        IN_TESTING = "in_testing"
        READY_FOR_FINALIZATION = "ready_for_finalization"
        DONE = "done"

    class OperationType(str, Enum):
        """Enumeration for the type of file system operation in a SLOT."""
        CREATE = "create"
        MODIFY = "modify"
        DELETE = "delete"
        REVIEW = "review" # For tasks that only involve reviewing code, not changing it.

    class Task(BaseModel):
        """Represents a single, well-defined unit of work (a user story or engineering task)."""
        task_id: str = Field(description="The unique identifier, e.g., 'TS-01'.")
        title: str = Field(description="A short, human-readable title for the task.")
        context: str = Field(description="The background for this task, explaining the 'why'.")
        implementation_details: str = Field(description="A high-level overview of the proposed 'how'.")
        dev_notes: Optional[str] = Field(None, description="Optional notes for the developer.")
        acceptance_criteria: List[str] = Field(default_factory=list)
        ac_verification_steps: List[str] = Field(default_factory=list)
        task_status: TaskStatus = Field(default=TaskStatus.NEW)

    class Taskflow(BaseModel):
        """Defines the step-by-step procedure and verification for a SLOT."""
        procedural_steps: List[str] = Field(description="Sequential steps for the AI to execute.")
        verification_steps: List[str] = Field(description="Checks or tests to verify the SLOT is complete.")

    class SLOT(BaseModel):
        """The core, self-contained, and atomic unit of technical work."""
        slot_id: str = Field(description="A unique ID for this SLOT, e.g., 'slot_1.1'.")
        title: str = Field(description="A short, human-readable title for the SLOT.")
        spec: str = Field(description="The detailed specification for this change.")
        location: str = Field(description="The primary file path or directory for the work.")
        operation: OperationType = Field(description="The type of file system operation.")
        taskflow: Taskflow = Field(description="The detailed workflow for execution and testing.")
    ```

#### **Acceptance Criteria:**
*   A new file `src/alfred_new/models/schemas.py` exists.
*   The file contains the `TaskStatus` and `OperationType` Enums.
*   The file contains the `Task`, `Taskflow`, and `SLOT` Pydantic models exactly as specified.
*   All models and enums are correctly typed and use `pydantic.BaseModel`.

#### **AC Verification:**
*   In a Python interpreter, import all models from the new file.
*   Successfully create an instance of a `Task` object, providing valid data. Confirm `task.task_status` is an instance of the `TaskStatus` enum.
*   Successfully create an instance of a `SLOT` object. Confirm `slot.operation` is an instance of the `OperationType` enum.
*   Confirm that attempting to create a `Task` with an invalid status (e.g., `task_status="in-progress"`) raises a `pydantic.ValidationError`.

#### **Unit Tests:**
*   Create a new test file `tests/models/test_schemas.py`.
*   Write a test `test_task_model_creation` to validate successful instantiation and default status.
*   Write a test `test_slot_model_creation` to validate successful instantiation.
*   Write a test `test_invalid_task_status_raises_error` to confirm a `ValidationError` is raised for invalid strings.
*   Write a test `test_serialization_and_deserialization` for both `Task` and `SLOT` models to ensure `model_dump_json()` and `model_validate_json()` work correctly.


